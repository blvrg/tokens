
<!DOCTYPE html>
<html>
<head>
    <title>btc tokens (xrc-20)</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ‘€</text></svg>">
    <style>        
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
        * {font-family: 'VT323', monospace; text-align:center}
        body {width:60%; margin:0 auto; font-size: 1.5rem}
        table {width:100%}
        img {width:75px; height:75px; image-rendering:pixelated}
    </style>
</head>
<body>
    <h1>btc tokens (xrc-20)</h1>
    <div id="loader"></div>
    <select id="filterSelect">
        <option value="all">All</option>
        <option value="deploy">Deploy</option>
        <option value="mint">Mint</option>
    </select>
    <table id="result"></table>
    <script>
        const SITE_URL = 'https://xchain.io/';
        const API_URL = 'https://xchain.io/api/';
        async function loadIssuances() {
            const filterSelect = document.getElementById('filterSelect');
            const filterType = filterSelect.value; // Get the selected filter type
            const data = await (await fetch('data.json')).json(); // Load data from local JSON file
            // If filterType is not 'all', filter the data
            const filteredData = filterType !== 'all' ? data.filter(issuance => issuance.type === filterType) : data;
            result.innerHTML = '<tr><th>#</th><th>Image</th><th>Name</th><th>Type</th><th>Supply</th><th>Max Mint</th><th>Dispenser</th></tr>';
            let deployData = {};
            for (let index = 0; index < filteredData.length; index++) {
                const issuance = filteredData[index];
                const type = issuance.type;
                const name = issuance.description.split('|')[1];
                const imageSrc = issuance.image || deployData[name];
                if(type === 'deploy') {
                    deployData[name] = imageSrc;
                }
                let row = document.createElement('tr');
                ['td', 'td', 'td', 'td', 'td', 'td', 'td'].forEach(td => row.appendChild(document.createElement(td)));
                row.cells[0].textContent = index + 1;
                row.cells[1].innerHTML = `<img src="${imageSrc}" />`;
                row.cells[2].innerHTML = `<a href="${SITE_URL}asset/${issuance.asset}">${name}</a>`;
                row.cells[3].textContent = type;
                row.cells[4].textContent = issuance.supply;
                row.cells[5].textContent = issuance.maxMint || '';
                const dispenserData = await (await fetch(`${API_URL}dispensers/${issuance.asset}?open`)).json();
                let dispenserLink = '';
                let dispenserText = '';
                if (dispenserData && dispenserData.data && dispenserData.data.length > 0) {
                    dispenserLink = `${SITE_URL}tx/${dispenserData.data[0].tx_hash}`;
                    let giveRemaining = dispenserData.data[0].give_remaining; // Get the give_remaining amount from the dispenser data
                    let satoshiPrice = dispenserData.data[0].satoshi_price; // Get the satoshi_price from the dispenser data

                    dispenserText = `${giveRemaining} @ ${satoshiPrice}`; // Format the text as 'x @ y'
                }
                row.cells[6].innerHTML = dispenserLink ? `<a href="${dispenserLink}">${dispenserText}</a>` : '';
                result.appendChild(row);
            };
            loader.style.display = 'none';
        }
        // Add event listener for the filter select
        document.getElementById('filterSelect').addEventListener('change', loadIssuances);
        window.onload = loadIssuances;  // Load issuances when the page loads
    </script>
</body>
</html>
